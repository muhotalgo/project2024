{% extends 'base.html' %}

{% block style %}
    <style>
        /* 기본으로 생기는 파란 라인 제거*/
        input:focus, textarea:focus, button:focus {
            outline:none;
        }

        a:hover {
            text-decoration: none;
        }

        body {
            font-family: "Orbit", sans-serif;
            font-weight: 400;
            font-style: normal;
            background-color: #E8E8E8;
        }

        .myaccount-menu {

            background-color: #fff;
            box-shadow: 0 2px 5px rgba(210, 210, 210, 0.1);
            margin: 30px 100px auto;
            border: solid #fff 10px;

            display:flex;
            flex-basis:200px;
            flex-shrink: 0;
            flex-direction: column;
            height: 500px;
        }

        div ul {
            list-style-type: none;
            padding: 0;
            margin-left: 30px;
        }

        h3 {
            font-size: 15px;
            line-height: 18px;
            font-weight: 700;
            margin-top: 15px;
            padding-top:15px;

        }

        .container {
            {#max-width: 1000px; /* 수정: 너비를 조금 더 넓게 설정 */#}
            margin-top: 30px;
            margin-left: 20px;
            background-color: #fff;
            padding: 0 10px;
            border-radius: 5px;
            border-right: solid #fff 10px;
            box-shadow: 0 2px 5px rgba(210, 210, 210, 0.1);
        }
        .form-group {
            text-align: left;
            margin-bottom: 10px;
            justify-content: center; /* 수평 가운데 정렬 */
        }

        .form-group-check {
            margin: 0;
            text-align: left;
            height: 67px;
            padding-bottom: -10px;

        }

        .form-group label {
            padding-right: 20px;
            margin-left: 3px;
            margin-top: -10px;
            /* margin-bottom: 2px; /* login은 10px*/
        {#display: block;#}
            font-weight: bold;
        }

        .form-group input[type="text"],
        .form-group input[type="password"],
        .form-group textarea {
            width: 95%;
            padding: 10px;
            margin-top: -5px;

            border: 1px solid #ccc;
            border-radius: 1px;
            box-sizing: border-box;
        }

        .form-select {
            padding: 10px;
            margin-bottom: 5px;
            border: 1px solid #ccc;
        }

        .form-control.btn-outline-primary {
            margin: 0 auto ;
            width: 60% ;
            background-color: #f4f4f4;
            text-align: center;
            font-size: 14px;
            color: black;
            border: 1px solid dimgrey ;
            padding: 14px;
            cursor: pointer;
            border-radius: 0;
        }

        .form-control.btn-outline-primary:hover {
            color: white;
            border: 1px solid transparent ;
            background-color: black;
        }


        /* 게시판 글 쓰기에 대한 스타일 */
        form { width: 700px; margin: 100px auto; }
        form div { margin-bottom: 5px }
        form input, form textarea { padding: 5px }
        form label { font-weight: bold; width: 110px; text-align: right }
        form button:first-child { margin-left:145px }
        .dragup { vertical-align: top }

    </style>

    <script src="https://js.hcaptcha.com/1/api.js?hl=ko&onload=myFunction&render=explicit"
            async defer>
    </script>

    <script type="text/javascript">
        var myFunction = () => {
            hcaptcha.render('captcha', {
                sitekey: '19e7b44f-2dfa-4f43-9e48-f42f824a3ad6',
                theme: 'light',
                'error-callback': 'onError',
            });
        };
    </script>
{% endblock %}

{% block main %}
    <main>
        <form name="qnafrm">
            <div class="row">
                <div class="col-auto"><label for="title" class="col-form-label">제목</label></div>
                <div class="col-auto"><input type="text" name="title" id="title" class="form-control" style="width: 300px"></div>
            </div>
            <div class="row">
                <div class="col-auto"><label for="userid" class="col-form-label">작성자</label></div>
                <div class="col-auto"><input type="text" name="userid" id="userid" value="{{ my.userid }}" class="form-control" readonly style="width: 300px"></div>
            </div>
            <div class="row" style="padding-right: 17px">
                <div class="col auto"><label for="contents" class="col-form-label">본문</label></div>
                <div class="col-auto"><textarea name="contents" class="form-control" id="contents" cols="50" rows="10"></textarea></div>
            </div>
{#            <div class="row">#}
{#                <div class="col-auto"><label for="attach" class="col-form-label">이미지파일</label></div>#}
{#                <div class="col-auto"><input type="file" id="attach" name="attach" ></div>#}
{#            </div>#}
            <div class="row">
                <div class="col-auto"><label for="captcha" class="dragup col-form-label"> </label></div>
                <div class="col-auto"><div id="captcha"></div>
                </div>
            </div>
                <div><button type="button" class="btn btn-primary" id="writebtn"><i class="bi bi-pencil-square"></i> 입력완료</button>
                    <button type="reset" class="btn btn-secondary"><i class="bi bi-arrow-repeat"></i> 다시입력</button></div>
        </form>
    </main>
{% endblock %}


{% block script %}
    <script>
    // 공백이면 안되는 함수 작성
    </script>
    <script>
        // 제출할때 userid 항목이 맞는지 검사하는 ajax 이용하기
    </script>
    <script>
        // 캡챠값
    </script>

{#    <script>#}
{#        let writebtn = document.querySelector('#writebtn');#}
{#        let qnafrm = document.qnafrm;#}
{#        writebtn.addEventListener('click', () => {#}
{#            if (hcaptcha.getResponse() === '') {#}
{#                alert('자동가입방지를 확인하세요!!');#}
{#                return;#}
{#            }#}
{#            console.log(hcaptcha.getResponse());#}
{#            alert('잠시 대기중...');#}
{##}
{##}
{#           #}
{##}
{##}
{#            qnafrm.method = 'post';#}
{#            qnafrm.enctype = 'multipart/form-data';#}
{#            qnafrm.submit();#}
{#        });#}
{##}
{#    </script>#}


    <script>
        let writebtn = document.querySelector('#writebtn');
        let qnafrm = document.qnafrm;
        writebtn.addEventListener('click', () => {

            // 리캡챠 체크 - 캡챠 응답토큰 생성여부 확인
            // console.log(hcaptcha.getResponse());
            // alert('잠시 대기중...');

            if (hcaptcha.getResponse() === '') {
                alert('자동가입방지를 확인하세요!!');
                return;
            }


            const formData = new FormData(qnafrm);
            let jsondata = {};
            formData.forEach((val, key) => {
                jsondata[key] = val;
            });
            // 캡챠 응답토큰을 jsondata에 추가
            jsondata['response'] = hcaptcha.getResponse();

            console.log(jsondata);


            fetch('http://127.0.0.1:8000/myinfo/contacts/write',{
                method: 'POST',
                headers: {
                    'Accept': 'application/json',
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(jsondata),
                redirect: 'follow'      // 서버에서 전송한 상태코드, url에 따름
            })
                .then((res) => {
                    // 상태코드가 3xx라면, 지정한 페이지로 이동 (300번대는 페이지전환에따른 상태코드)
                    if (res.redirected) location.href = res.url;
                })
                .catch((err) => console.log(err));
        });

    </script>
{% endblock %}
